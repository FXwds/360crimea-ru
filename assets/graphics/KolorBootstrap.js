var krpano=null;var debug=false;var krpanoLoaded=false;var pluginLoaded=new ktools.Map();var isTourStarted=false;var kolorFullscreen=null;var kolorBrowserDetect=null;var kolorStartIndex=4000;var crossDomainTargetUrl='';var tourLanguage;if(debug){if(typeof(console)=='undefined'){console={log:function(text){}};}}jQuery(document).ready(function(){kolorBrowserDetect=new ktools.BrowserDetect();kolorBrowserDetect.init();kolorFullscreen=new ktools.Fullscreen(document.getElementById("tourDIV"));kolorFullscreen.supportsFullscreen();kolorFullscreen.setExternal({'enter':krPanoFullscreenEnter,'exit':krPanoFullscreenExit,'change':krpanoFullscreenChange,'resize':krPanoFullscreenResize});});function krPanoFullscreenEnter(){var ki=getKrPanoInstance();if(ki!==null){getKrPanoInstance().call("enterFullScreenFallback");}}function krPanoFullscreenExit(){var ki=getKrPanoInstance();if(ki!==null){ki.call("exitFullScreenFallback");}}function krpanoFullscreenChange(state){var ki=getKrPanoInstance();if(ki!==null){if(state){getKrPanoInstance().call("enterFullScreenChangeEvent");}else{getKrPanoInstance().call("exitFullScreenChangeEvent");}}}function krPanoFullscreenResize(){var ki=getKrPanoInstance();if(ki!==null){getKrPanoInstance().call("resizeFullScreenEvent");}}function setFullscreen(value){var state;if(typeof value=="string")state=(value.toLowerCase()=="true");else
state=Boolean(value);if(kolorFullscreen){if(state){kolorFullscreen.request();}else{kolorFullscreen.exit();}}}function getKrPanoInstance(){if(krpano==null){krpano=document.getElementById('krpanoSWFObject');}return krpano;}function invokeKrFunction(fnName){var args=[].slice.call(arguments,1);var callString=fnName+'(';for(var i=0,ii=args.length;i<ii;i++){callString+=args[i];if(i!=ii-1){callString+=', ';}}callString+=');';if(getKrPanoInstance()!==null){getKrPanoInstance().call(callString);}}function getKrValue(identifier,type){if(typeof identifier=="undefined"){return identifier;}if(getKrPanoInstance()!==null){if(getKrPanoInstance().get(identifier)==null){return null;}switch(type){case"int":return parseInt(getKrPanoInstance().get(identifier));case"float":return parseFloat(getKrPanoInstance().get(identifier));case"string":return String(getKrPanoInstance().get(identifier));case"bool":return Boolean(getKrPanoInstance().get(identifier)==='true'||parseInt(getKrPanoInstance().get(identifier))===1||getKrPanoInstance().get(identifier)==='yes'||getKrPanoInstance().get(identifier)==='on');default:return getKrPanoInstance().get(identifier);}}else{return null;}}function invokePluginFunction(pluginName,functionName){if(debug){console.log("invokePluginFunction("+pluginName+", "+functionName+")");}var plugin=ktools.KolorPluginList.getInstance().getPlugin(pluginName);if(plugin==null){if(debug){console.log("invokePluginFunction: plugin instance doesn't exist");}if(pluginLoaded&&pluginLoaded.item(pluginName)){pluginLoaded.update(pluginName,arguments);}else{pluginLoaded.add(pluginName,arguments);}return false;}var engine=plugin.getRegistered();if(engine==null){if(debug){console.log("invokePluginFunction: plugin isn't registered");}if(pluginLoaded&&pluginLoaded.item(pluginName)){pluginLoaded.update(pluginName,arguments);}else{pluginLoaded.add(pluginName,arguments);}return false;}var restArgs=[].slice.call(arguments,2);return engine[functionName](restArgs);}function eventKrpanoLoaded(isWebVr){if(debug){console.log('krpano is loaded');}if(krpanoLoaded){return false;}tourLanguage=getKrValue("tour_language","string")
if(typeof tourLanguage=="undefined"){tourLanguage='en';}ktools.I18N.getInstance().initLanguage(tourLanguage,crossPanoUrl+'indexdata/index_messages_','.xml');krpanoLoaded=true;if(isWebVr){}else{addKolorArea('description');addKolorBox('socialShare');addKolorArea('floorPlanArea');}}function eventUnloadPlugins(){resetValuesForPlugins();deleteKolorBox('socialShare');deleteKolorArea('description');deleteKolorFloorPlan('floorPlan');deleteKolorArea('floorPlanArea');}function resetValuesForPlugins(){krpano=null;krpanoLoaded=false;isTourStarted=false;pluginLoaded=new ktools.Map();kolorStartIndex=4000;}function eventTourStarted(){if(debug){console.log('tour is started');}isTourStarted=true;}function eventTourChangeLanguage(pLang){if(debug){console.log('change tour language : '+pLang);}ktools.I18N.getInstance().initLanguage(pLang,crossPanoUrl+'indexdata/index_messages_','.xml');}function addKolorFloorPlan(pPlugID,pContent){if(typeof ktools.KolorPluginList.getInstance().getPlugin(pPlugID)=="undefined"){var kolorFloorPlanCSS=new ktools.CssStyle("KolorFloorPlanCSS",crossPanoUrl+"indexdata/graphics/KolorFloorPlan/kolorFloorPlan.css");var kolorFloorPlanJS=new ktools.Script("KolorFloorPlanJS",crossPanoUrl+"indexdata/graphics/KolorFloorPlan/KolorFloorPlan.min.js",[],true);var kolorFloorPlanPlugin=new ktools.KolorPlugin(pPlugID);kolorFloorPlanPlugin.addScript(kolorFloorPlanJS);kolorFloorPlanPlugin.addCss(kolorFloorPlanCSS);ktools.KolorPluginList.getInstance().addPlugin(kolorFloorPlanPlugin.getPluginName(),kolorFloorPlanPlugin,true);}showKolorFloorPlan(pPlugID,pContent);}function showKolorFloorPlan(pPlugID,pContent){if(debug){console.log("showKolorFloorPlan "+pPlugID);}if(!ktools.KolorPluginList.getInstance().getPlugin(pPlugID).isInitialized()||typeof KolorFloorPlan=="undefined"){var err="KolorFloorPlan is not loaded";if(debug){console.log(err);}setTimeout(function(){showKolorFloorPlan(pPlugID,pContent);},100);return;}if(ktools.KolorPluginList.getInstance().getPlugin(pPlugID).getRegistered()==null){ktools.KolorPluginList.getInstance().getPlugin(pPlugID).register(new KolorFloorPlan(pPlugID,pContent));}var kolorFloorPlan=ktools.KolorPluginList.getInstance().getPlugin(pPlugID).getRegistered();if(!kolorFloorPlan.isReady()){var kolorFloorPlanOptions=[];var optionName='';var optionValue='';var optionLength=parseInt(getKrPanoInstance().get("ptplugin["+pPlugID+"].settings[0].option.count"));for(var j=0;j<optionLength;j++){optionName=getKrValue("ptplugin["+pPlugID+"].settings[0].option["+j+"].name","string");optionValue=getKrValue("ptplugin["+pPlugID+"].settings[0].option["+j+"].value",getKrValue("ptplugin["+pPlugID+"].settings[0].option["+j+"].type","string"));kolorFloorPlanOptions[optionName]=optionValue;}kolorFloorPlanOptions['device']=getKrValue('vrtourdevice','string');kolorFloorPlan.setKolorFloorPlanOptions(kolorFloorPlanOptions);var kolorFloorPlanItems=[];var kolorFloorPlanSpots=[];var planName='';var planValues=null;var planSpots=null;var planSpot=null;var kolorFloorPlanSelectedItem=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].selectedItem","string");var kolorFloorPlanSelectedSpot=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].selectedSpot","string");var kolorFloorPlanSelectedSpotOptions=[getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].selectedSpotScene","string"),getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].selectedSpotHeading","float"),getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].selectedSpotFov","float")];var floorplansLength=parseInt(getKrPanoInstance().get("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem.count"));for(var j=0;j<floorplansLength;j++){planName=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].name","string");planValues=new Object();planValues.title=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].title","string");planValues.src=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].url","string");planValues.width=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].width","int");planValues.height=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].height","int");planValues.heading=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].heading","float");kolorFloorPlanItems[planName]=planValues;planSpots=[];var floorplansItemsLength=parseInt(getKrPanoInstance().get("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].spot.count"));for(var k=0;k<floorplansItemsLength;k++){planSpot=new Object();planSpot.name=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].spot["+k+"].name","string");planSpot.posx=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].spot["+k+"].posX","float");planSpot.posy=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].spot["+k+"].posY","float");planSpot.heading=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].spot["+k+"].heading","float");planSpot.desc=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].spot["+k+"].desc","string");planSpot.desctype=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].spot["+k+"].descType","string");planSpot.scene=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].spot["+k+"].scene","string");planSpot.jsclick=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].spot["+k+"].jsClick","string");planSpot.planar=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].spot["+k+"].planar","bool");planSpot.icon=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].spot["+k+"].icon[0].url","string");planSpot.width=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].spot["+k+"].icon[0].iconWidth","int");planSpot.height=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].spot["+k+"].icon[0].iconHeight","int");planSpot.anchor=getKrValue("ptplugin["+pPlugID+"].floorplanItems[0].floorplanItem["+j+"].spot["+k+"].icon[0].iconAnchor","string");planSpots[planSpot.name]=planSpot;}kolorFloorPlanSpots[planName]=planSpots;}kolorFloorPlan.setKolorFloorPlanItems(kolorFloorPlanItems);kolorFloorPlan.setKolorFloorPlanSpots(kolorFloorPlanSpots);kolorFloorPlan.setKolorFloorPlanSelectedItem(kolorFloorPlanSelectedItem);kolorFloorPlan.setKolorFloorPlanSelectedSpot(kolorFloorPlanSelectedSpot);kolorFloorPlan.setKolorFloorPlanSelectedSpotOptions(kolorFloorPlanSelectedSpotOptions);kolorFloorPlan.setKrpanoEngine(getKrPanoInstance());kolorFloorPlan.setGraphicsUrl(crossPanoUrl+"indexdata/graphics/"+pPlugID.toLowerCase()+"/");kolorFloorPlan.setReady(true);invokeKrFunction("kolorFloorplanJsReady_"+pPlugID);}kolorFloorPlan.showKolorFloorPlan();if(pluginLoaded&&pluginLoaded.item(pPlugID)){invokePluginFunction.apply(null,pluginLoaded.item(pPlugID).funcArgs);pluginLoaded.remove(pPlugID);}}function deleteKolorFloorPlan(pPlugID){if(ktools.KolorPluginList.getInstance().getPlugin(pPlugID)){ktools.KolorPluginList.getInstance().removePlugin(pPlugID);}}function addKolorBox(pPlugID){if(typeof ktools.KolorPluginList.getInstance().getPlugin(pPlugID)=="undefined"){var kolorBoxCSS=new ktools.CssStyle("KolorBoxCSS",crossPanoUrl+"indexdata/graphics/KolorBox/kolorBox.css");var kolorBoxJS=new ktools.Script("KolorBoxJS",crossPanoUrl+"indexdata/graphics/KolorBox/KolorBox.min.js",[],true);var kolorBoxPlugin=new ktools.KolorPlugin(pPlugID);kolorBoxPlugin.addScript(kolorBoxJS);kolorBoxPlugin.addCss(kolorBoxCSS);ktools.KolorPluginList.getInstance().addPlugin(kolorBoxPlugin.getPluginName(),kolorBoxPlugin,true);showKolorBox(pPlugID,0,true);}}function showKolorBox(pPlugID,pIndex,pInitOnly){if(debug){console.log("showKolorBox "+pPlugID);}if(!ktools.KolorPluginList.getInstance().getPlugin(pPlugID).isInitialized()||typeof KolorBox==="undefined"){err="KolorBox JS or XML is not loaded !";if(debug){console.log(err);}setTimeout(function(){showKolorBox(pPlugID,pIndex,pInitOnly);},100);return;}if(ktools.KolorPluginList.getInstance().getPlugin(pPlugID).getRegistered()===null){ktools.KolorPluginList.getInstance().getPlugin(pPlugID).register(new KolorBox(pPlugID,"panoDIV"));}var kolorBox=ktools.KolorPluginList.getInstance().getPlugin(pPlugID).getRegistered();if(!kolorBox.isReady()){var kolorBoxOptions=[];var optionName='';var optionValue='';var optionLength=parseInt(getKrPanoInstance().get("ptplugin["+pPlugID+"].settings[0].option.count"));for(var j=0;j<optionLength;j++){optionName=getKrValue("ptplugin["+pPlugID+"].settings[0].option["+j+"].name","string");if(optionName=='zorder'){optionValue=kolorStartIndex+getKrValue("ptplugin["+pPlugID+"].settings[0].option["+j+"].value",getKrValue("ptplugin["+pPlugID+"].settings[0].option["+j+"].type","string"));}else{optionValue=getKrValue("ptplugin["+pPlugID+"].settings[0].option["+j+"].value",getKrValue("ptplugin["+pPlugID+"].settings[0].option["+j+"].type","string"));}kolorBoxOptions[optionName]=optionValue;}kolorBoxOptions['device']=getKrValue('vrtourdevice','string');kolorBox.setKolorBoxOptions(kolorBoxOptions);if(kolorBoxOptions['starts_opened']){pInitOnly=false;}var kbItem=null;var itemLength=parseInt(getKrPanoInstance().get("ptplugin["+pPlugID+"].internaldata[0].item.count"));for(var k=0;k<itemLength;k++){kbItem=new KolorBoxObject();kbItem.setName(getKrValue("ptplugin["+pPlugID+"].internaldata[0].item["+k+"].name","string"));kbItem.setTitle(getKrValue("ptplugin["+pPlugID+"].internaldata[0].item["+k+"].title","string"));kbItem.setCaption(getKrValue("ptplugin["+pPlugID+"].internaldata[0].item["+k+"].caption","string"));kbItem.setValue(getKrValue("ptplugin["+pPlugID+"].internaldata[0].item["+k+"].value","string"));if(kbItem.getValue()==="externalData")kbItem.setData(getKrValue('data['+getKrValue("ptplugin["+pPlugID+"].internaldata[0].item["+k+"].dataName","string")+'].content','string'));kolorBox.addKolorBoxItem(kbItem);kbItem.init();}kolorBox.setReady(true);invokeKrFunction("kolorBoxJsReady_"+pPlugID);}if(typeof pPlugID!=="undefined"&&(typeof pInitOnly==="undefined"||pInitOnly===false)){if(typeof pIndex==="undefined"){pIndex=0;}kolorBox.openKolorBox(pIndex);}if(pluginLoaded&&pluginLoaded.item(pPlugID)){invokePluginFunction.apply(null,pluginLoaded.item(pPlugID));pluginLoaded.remove(pPlugID);}}function deleteKolorBox(pPlugID){if(ktools.KolorPluginList.getInstance().getPlugin(pPlugID)){ktools.KolorPluginList.getInstance().removePlugin(pPlugID);}var parent=document.getElementById("panoDIV");var child=document.getElementById(pPlugID);if(parent&&child){parent.removeChild(child);}}function addKolorArea(pPlugID){if(typeof ktools.KolorPluginList.getInstance().getPlugin(pPlugID)=="undefined"){var kolorAreaCSS=new ktools.CssStyle("KolorAreaCSS",crossPanoUrl+"indexdata/graphics/KolorArea/kolorArea.css");var kolorAreaJS=new ktools.Script("KolorAreaJS",crossPanoUrl+"indexdata/graphics/KolorArea/KolorArea.min.js",[],true);var kolorAreaPlugin=new ktools.KolorPlugin(pPlugID);kolorAreaPlugin.addScript(kolorAreaJS);kolorAreaPlugin.addCss(kolorAreaCSS);ktools.KolorPluginList.getInstance().addPlugin(kolorAreaPlugin.getPluginName(),kolorAreaPlugin,true);}}function showKolorArea(pPlugID,pContent){if(debug){console.log("showKolorArea "+pPlugID);}if(!ktools.KolorPluginList.getInstance().getPlugin(pPlugID).isInitialized()||typeof KolorArea=="undefined"){err="KolorArea JS is not loaded !";if(debug){console.log(err);}setTimeout(function(){showKolorArea(pPlugID,pContent);},100);return;}if(ktools.KolorPluginList.getInstance().getPlugin(pPlugID).getRegistered()==null){ktools.KolorPluginList.getInstance().getPlugin(pPlugID).register(new KolorArea(pPlugID,"panoDIV"));}var kolorArea=ktools.KolorPluginList.getInstance().getPlugin(pPlugID).getRegistered();if(!kolorArea.isReady()){var kolorAreaOptions=[];var optionName='';var optionValue='';var optionLength=parseInt(getKrPanoInstance().get("ptplugin["+pPlugID+"].settings[0].option.count"));for(var j=0;j<optionLength;j++){optionName=getKrValue("ptplugin["+pPlugID+"].settings[0].option["+j+"].name","string");if(optionName=='zorder'){optionValue=kolorStartIndex+getKrValue("ptplugin["+pPlugID+"].settings[0].option["+j+"].value",getKrValue("ptplugin["+pPlugID+"].settings[0].option["+j+"].type","string"));}else{optionValue=getKrValue("ptplugin["+pPlugID+"].settings[0].option["+j+"].value",getKrValue("ptplugin["+pPlugID+"].settings[0].option["+j+"].type","string"));}kolorAreaOptions[optionName]=optionValue;}kolorAreaOptions['device']=getKrValue('vrtourdevice','string');kolorArea.setKolorAreaOptions(kolorAreaOptions);kolorArea.setReady(true);invokeKrFunction("kolorAreaJsReady_"+pPlugID);}kolorArea.setKolorAreaContent(pContent);kolorArea.openKolorArea();if(pluginLoaded&&pluginLoaded.item(pPlugID)){invokePluginFunction.apply(null,pluginLoaded.item(pPlugID).funcArgs);pluginLoaded.remove(pPlugID);}}function deleteKolorArea(pPlugID){if(ktools.KolorPluginList.getInstance().getPlugin(pPlugID)){ktools.KolorPluginList.getInstance().removePlugin(pPlugID);}var parent=document.getElementById("panoDIV");var child=document.getElementById(pPlugID);if(parent&&child){parent.removeChild(child);}}